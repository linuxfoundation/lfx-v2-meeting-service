# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT
---
# image is the configuration for the container images
image:
  # repository is the container image repository
  repository: ghcr.io/linuxfoundation/lfx-v2-meeting-service/meeting-api
  # tag is the container image tag (overrides appVersion from Chart.yaml)
  tag: ""
  # pullPolicy is the image pull policy
  pullPolicy: IfNotPresent

replicaCount: 3

resources:
  # limits define the maximum resources the container can use
  limits:
    cpu: 500m
    memory: 512Mi
  # requests define the minimum resources the container needs
  requests:
    cpu: 100m
    memory: 128Mi

# app is the configuration for the application
app:
  # audience is the JWT audience required for this authentication with this app
  audience: lfx-v2-meeting-service
  # use_oidc_contextualizer is a boolean to determine if the OIDC contextualizer should be used
  use_oidc_contextualizer: true

  environment:
    # LOG_LEVEL is optional
    LOG_LEVEL:
      value: info
    # LOG_ADD_SOURCE is optional
    LOG_ADD_SOURCE:
      value: true
    # JWKS_URL is required unless JWT_AUTH_DISABLED_MOCK_LOCAL_PRINCIPAL is set to a non-empty value
    JWKS_URL:
      value: http://lfx-platform-heimdall.lfx.svc.cluster.local:4457/.well-known/jwks
    # JWT_AUDIENCE is required
    JWT_AUDIENCE:
      value: lfx-v2-meeting-service
    # JWT_AUTH_DISABLED_MOCK_LOCAL_PRINCIPAL is optional (for local dev only)
    JWT_AUTH_DISABLED_MOCK_LOCAL_PRINCIPAL:
      value: ''
    # LFX_ENVIRONMENT is optional (dev, staging, prod) - defaults to prod if not set
    LFX_ENVIRONMENT:
      value: prod
    # ITX_BASE_URL is the base URL for the ITX service (required)
    ITX_BASE_URL:
      value: https://api.dev.itx.linuxfoundation.org
    # ITX_CLIENT_ID is the OAuth2 client ID for ITX service authentication
    ITX_CLIENT_ID:
      value: null
    # ITX_CLIENT_SECRET is the OAuth2 client secret for ITX service authentication
    ITX_CLIENT_SECRET:
      value: null
    # ITX_AUTH0_DOMAIN is the Auth0 domain for ITX OAuth2 authentication
    ITX_AUTH0_DOMAIN:
      value: linuxfoundation-dev.auth0.com
    # ITX_AUDIENCE is the OAuth2 audience for ITX service
    ITX_AUDIENCE:
      value: https://api.dev.itx.linuxfoundation.org/
    # ID_MAPPING_DISABLED disables v1/v2 ID mapping (optional, defaults to false)
    # Set to "true" to disable ID mapping and pass IDs through unchanged
    ID_MAPPING_DISABLED:
      value: "false"
    # NATS_URL is optional - only needed if ID mapping is enabled and using NATS mapper
    # If ID_MAPPING_DISABLED=true, this is not used
    NATS_URL:
      value: nats://lfx-platform-nats.lfx.svc.cluster.local:4222
    # OTEL_SERVICE_NAME is the service name for OpenTelemetry resource identification
    # (default: "lfx-v2-meeting-service")
    # OTEL_SERVICE_NAME:
    #   value: lfx-v2-meeting-service
    # OTEL_SERVICE_VERSION is the service version for OpenTelemetry resource identification
    # (default: "")
    # OTEL_SERVICE_VERSION:
    #   value: "1.0.0"
    # OTEL_EXPORTER_OTLP_PROTOCOL specifies the OTLP protocol: "grpc" or "http"
    # (default: "grpc")
    # OTEL_EXPORTER_OTLP_PROTOCOL:
    #   value: grpc
    # OTEL_EXPORTER_OTLP_ENDPOINT is the OTLP collector endpoint
    # For gRPC: typically "host:4317", for HTTP: typically "host:4318"
    # OTEL_EXPORTER_OTLP_ENDPOINT:
    #   value: jaeger-collector.observability.svc.cluster.local:4317
    # OTEL_EXPORTER_OTLP_INSECURE disables TLS for the OTLP connection
    # Set to "true" for in-cluster communication without TLS
    # OTEL_EXPORTER_OTLP_INSECURE:
    #   value: "true"
    # OTEL_TRACES_EXPORTER specifies the traces exporter: "otlp" or "none"
    # (default: "none")
    # OTEL_TRACES_EXPORTER:
    #   value: otlp
    # OTEL_TRACES_SAMPLE_RATIO specifies the sampling ratio for traces (0.0 to 1.0)
    # A value of 1.0 means all traces are sampled, 0.5 means 50% are sampled
    # (default: "1.0")
    # OTEL_TRACES_SAMPLE_RATIO:
    #   value: "1.0"
    # OTEL_METRICS_EXPORTER specifies the metrics exporter: "otlp" or "none"
    # (default: "none")
    # OTEL_METRICS_EXPORTER:
    #   value: otlp
    # OTEL_LOGS_EXPORTER specifies the logs exporter: "otlp" or "none"
    # (default: "none")
    # OTEL_LOGS_EXPORTER:
    #   value: otlp

# traefik is the configuration for Traefik Gateway API routing
traefik:
  # gateway specifies the platform Gateway to attach to
  gateway:
    name: lfx-platform-gateway
    namespace: lfx

# lfx is the configuration for LFX platform
lfx:
  # domain is the base domain for routing
  domain: k8s.orb.local
  # namespace is the target namespace for deployment
  namespace: lfx

# service is the configuration for the Kubernetes service
service:
  # port is the service port
  port: 8080

# serviceAccount is the configuration for the Kubernetes service account
serviceAccount:
  # create specifies whether a service account should be created
  create: true
  # name is the name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""
  # annotations to add to the service account
  annotations: {}
  # automountServiceAccountToken is a boolean to determine if the service account token should be automatically mounted
  automountServiceAccountToken: true

# openfga is the configuration for the OpenFGA server
openfga:
  # enabled is a boolean to determine if the OpenFGA server should be enabled for authorization
  # Note: If it is disabled, then the meeting service will allow all requests
  # (Disabling OpenFGA should only be used for local development).
  enabled: true

# heimdall is the configuration for the heimdall middleware
heimdall:
  enabled: true
  url: http://lfx-platform-heimdall.lfx.svc.cluster.local:4456
  add_middleware: false
