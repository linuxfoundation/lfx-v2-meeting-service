# ITX Registrants API Contracts

This document details the API contracts for ITX Zoom meeting registrant proxy endpoints, showing both the proxy API (LFX Meeting Service) and the underlying ITX API schemas.

## Overview

The LFX Meeting Service proxies registrant requests to the ITX Zoom API service:

```
Client → LFX Meeting Service (Proxy) → ITX Service → Zoom API
```

**Proxy API (LFX Meeting Service)**:

- Base Path: `/itx/meetings/{meeting_id}/registrants`
- Authorization: Bearer token (JWT via Heimdall/OpenFGA)
- Version: Query parameter `v` (e.g., `?v=1`)

**ITX API (Underlying Service)**:

- Base Path: `/v2/zoom/meetings/{meeting_id}/registrants`
- Authorization: OAuth2 M2M (added automatically by proxy)
- Header: `x-scope: manage:zoom`

---

## Create Registrant

### Proxy API Endpoint

**Method**: `POST /itx/meetings/{meeting_id}/registrants?v=1`

**Authorization**: Requires `organizer` permission on the meeting

**Request Headers**:

```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID

**Request Body**:

```json
{
  "committee_uid": "committee-uuid",
  "user_id": "lfx-user-123",
  "email": "john.doe@example.com",
  "username": "jdoe",
  "first_name": "John",
  "last_name": "Doe",
  "org": "Example Corp",
  "job_title": "Senior Developer",
  "profile_picture": "https://example.com/avatar.jpg",
  "host": false,
  "occurrence": "1666848600"
}
```

**Request Fields**:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `committee_uid` | string | No | Committee UID (for committee registrants) |
| `user_id` | string | No | LF user ID |
| `email` | string | No | Registrant email address |
| `username` | string | No | LF username |
| `first_name` | string | Conditional | Required with email |
| `last_name` | string | Conditional | Required with email |
| `org` | string | No | Organization name |
| `job_title` | string | No | Job title |
| `profile_picture` | string | No | Profile picture URL |
| `host` | boolean | No | Access to host key |
| `occurrence` | string | No | Specific occurrence ID (blank = all) |

**Response**: `201 Created`

```json
{
  "id": "zjkfsdfjdfhg",
  "type": "direct",
  "committee_uid": "committee-uuid",
  "user_id": "lfx-user-123",
  "email": "john.doe@example.com",
  "username": "jdoe",
  "first_name": "John",
  "last_name": "Doe",
  "org": "Example Corp",
  "job_title": "Senior Developer",
  "profile_picture": "https://example.com/avatar.jpg",
  "host": false,
  "occurrence": "1666848600",
  "attended_occurrence_count": 0,
  "total_occurrence_count": 1,
  "last_invite_received_time": "2024-01-10T08:00:00Z",
  "last_invite_received_message_id": "msg-123",
  "last_invite_delivery_status": "delivered",
  "last_invite_delivery_description": "Successfully delivered",
  "created_at": "2024-01-10T08:00:00Z",
  "created_by": {
    "id": "user123",
    "username": "admin",
    "name": "Admin User",
    "email": "admin@example.com",
    "profile_picture": "https://example.com/admin.jpg"
  },
  "modified_at": "2024-01-10T08:00:00Z",
  "updated_by": {
    "id": "user123",
    "username": "admin",
    "name": "Admin User",
    "email": "admin@example.com",
    "profile_picture": "https://example.com/admin.jpg"
  }
}
```

**Response Fields** (Read-only fields):

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Registrant ID (generated by ITX/Zoom) |
| `type` | string | Registrant type: "direct" or "committee" |
| `attended_occurrence_count` | integer | Number of meetings attended |
| `total_occurrence_count` | integer | Total meetings registered for |
| `last_invite_received_time` | string | Last invite timestamp (RFC3339) |
| `last_invite_received_message_id` | string | Last email message ID |
| `last_invite_delivery_status` | string | "delivered" or "failed" |
| `last_invite_delivery_description` | string | Delivery status details |
| `created_at` | string | Creation timestamp (RFC3339) |
| `created_by` | object | Creator user info |
| `modified_at` | string | Last modified timestamp (RFC3339) |
| `updated_by` | object | Last updater user info |

### ITX API Endpoint

**Method**: `POST /v2/zoom/meetings/{meeting_id}/registrants`

**Request Headers**:

```
Authorization: Bearer <oauth2_m2m_token>
x-scope: manage:zoom
Content-Type: application/json
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID

**Request Body**:

```json
{
  "committee_id": "committee-uuid",
  "user_id": "lfx-user-123",
  "email": "john.doe@example.com",
  "username": "jdoe",
  "first_name": "John",
  "last_name": "Doe",
  "org": "Example Corp",
  "job_title": "Senior Developer",
  "profile_picture": "https://example.com/avatar.jpg",
  "host": false,
  "occurrence": "1666848600"
}
```

**Response**: `201 Created`

Response body is identical to proxy response, except `committee_id` instead of `committee_uid`.

### Field Mapping

| Proxy API (LFX) | ITX API | Notes |
|-----------------|---------|-------|
| `committee_uid` | `committee_id` | Committee identifier |
| All other fields | Identical | Same field names |

---

## Get Registrant

### Proxy API Endpoint

**Method**: `GET /itx/meetings/{meeting_id}/registrants/{registrant_id}?v=1`

**Authorization**: Requires `auditor` permission on the meeting

**Request Headers**:

```
Authorization: Bearer <jwt_token>
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `200 OK`

Response body is identical to Create Registrant response.

### ITX API Endpoint

**Method**: `GET /v2/zoom/meetings/{meeting_id}/registrants/{registrant_id}`

**Request Headers**:

```
Authorization: Bearer <oauth2_m2m_token>
x-scope: manage:zoom
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `200 OK`

Response body is identical to ITX Create Registrant response.

### Field Mapping

Same as Create Registrant field mapping.

---

## Update Registrant

### Proxy API Endpoint

**Method**: `PUT /itx/meetings/{meeting_id}/registrants/{registrant_id}?v=1`

**Authorization**: Requires `organizer` permission on the meeting

**Request Headers**:

```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Request Body**: Same as Create Registrant request body

**Response**: `204 No Content`

### ITX API Endpoint

**Method**: `PUT /v2/zoom/meetings/{meeting_id}/registrants/{registrant_id}`

**Request Headers**:

```
Authorization: Bearer <oauth2_m2m_token>
x-scope: manage:zoom
Content-Type: application/json
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Request Body**: Same as ITX Create Registrant request body

**Response**: `204 No Content`

### Field Mapping

Same as Create Registrant field mapping.

---

## Delete Registrant

### Proxy API Endpoint

**Method**: `DELETE /itx/meetings/{meeting_id}/registrants/{registrant_id}?v=1`

**Authorization**: Requires `organizer` permission on the meeting

**Request Headers**:

```
Authorization: Bearer <jwt_token>
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `204 No Content`

### ITX API Endpoint

**Method**: `DELETE /v2/zoom/meetings/{meeting_id}/registrants/{registrant_id}`

**Request Headers**:

```
Authorization: Bearer <oauth2_m2m_token>
x-scope: manage:zoom
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `204 No Content`

---

## Get Registrant ICS Calendar File

### Proxy API Endpoint

**Method**: `GET /itx/meetings/{meeting_id}/registrants/{registrant_id}/ics?v=1`

**Authorization**: Requires `viewer` permission on the meeting

**Request Headers**:

```
Authorization: Bearer <jwt_token>
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `200 OK`

**Response Headers**:

```
Content-Type: text/calendar
```

**Response Body**: Raw ICS calendar file (binary data)

```
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Zoom//Zoom Meeting//EN
BEGIN:VEVENT
UID:1234567890@zoom.us
DTSTART:20240115T100000Z
DTEND:20240115T110000Z
SUMMARY:Weekly Team Sync
DESCRIPTION:Weekly team synchronization meeting
LOCATION:https://zoom.us/j/1234567890
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR
```

### ITX API Endpoint

**Method**: `GET /v2/zoom/meetings/{meeting_id}/registrants/{registrant_id}/ics`

**Request Headers**:

```
Authorization: Bearer <oauth2_m2m_token>
x-scope: manage:zoom
Accept: text/calendar
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `200 OK`

**Response Headers**:

```
Content-Type: text/calendar
```

**Response Body**: Identical to Proxy API (raw ICS calendar file)

---

## Resend Registrant Invitation

### Proxy API Endpoint

**Method**: `POST /itx/meetings/{meeting_id}/registrants/{registrant_id}/resend?v=1`

**Authorization**: Requires `organizer` permission on the meeting

**Request Headers**:

```
Authorization: Bearer <jwt_token>
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `204 No Content`

### ITX API Endpoint

**Method**: `POST /v2/zoom/meetings/{meeting_id}/registrants/{registrant_id}/resend`

**Request Headers**:

```
Authorization: Bearer <oauth2_m2m_token>
x-scope: manage:zoom
```

**Path Parameters**:

- `meeting_id` (string, required) - The Zoom meeting ID
- `registrant_id` (string, required) - The registrant ID

**Response**: `204 No Content`

---

## Common Data Types

### User Object

Structure is identical in both APIs:

```json
{
  "id": "user123",
  "username": "jdoe",
  "name": "John Doe",
  "email": "john.doe@example.com",
  "profile_picture": "https://example.com/avatar.jpg"
}
```

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | User ID |
| `username` | string | Username |
| `name` | string | Full name |
| `email` | string | Email address |
| `profile_picture` | string | Profile picture URL |

---

## Summary of Key Differences

| Aspect | Proxy API (LFX) | ITX API |
|--------|-----------------|---------|
| **Base Path** | `/itx/meetings/{meeting_id}/registrants` | `/v2/zoom/meetings/{meeting_id}/registrants` |
| **Authentication** | JWT Bearer token | OAuth2 M2M token |
| **Authorization** | Heimdall/OpenFGA (organizer/auditor/viewer) | Handled by ITX service |
| **Committee Field** | `committee_uid` | `committee_id` |
| **Other Fields** | All identical | All identical |
| **Required Header** | `Authorization: Bearer <jwt>` | `Authorization: Bearer <oauth2>` + `x-scope: manage:zoom` |

**Note**: The primary difference between proxy and ITX APIs is the committee field name:

- Proxy uses `committee_uid` to match LFX naming conventions
- ITX uses `committee_id` as required by the underlying Zoom integration
- All other fields use identical names in both APIs

---

## Authorization Requirements

| Endpoint | Required Permission |
|----------|-------------------|
| Create Registrant | `organizer` on meeting |
| Get Registrant | `auditor` on meeting |
| Update Registrant | `organizer` on meeting |
| Delete Registrant | `organizer` on meeting |
| Get Registrant ICS | `viewer` on meeting |
| Resend Registrant Invitation | `organizer` on meeting |

---

## Error Responses

Both APIs return similar error structures:

**HTTP Status Codes**:

- `400 Bad Request` - Invalid request parameters
- `401 Unauthorized` - Missing or invalid authentication
- `403 Forbidden` - Insufficient permissions
- `404 Not Found` - Meeting or registrant not found
- `409 Conflict` - Registrant already exists (for create)
- `500 Internal Server Error` - Server error
- `503 Service Unavailable` - Service temporarily unavailable

**Error Response Body**:

```json
{
  "error": "Error message describing what went wrong",
  "message": "Detailed error message"
}
```

---

## Registrant Types

### Direct Registrants

Direct registrants are manually added to a meeting by organizers or register themselves.

**Example**:

```json
{
  "type": "direct",
  "email": "john.doe@example.com",
  "first_name": "John",
  "last_name": "Doe"
}
```

### Committee Registrants

Committee registrants are automatically registered based on committee membership.

**Example**:

```json
{
  "type": "committee",
  "committee_uid": "committee-uuid",
  "user_id": "lfx-user-123"
}
```

---

## Email Delivery Tracking

Registrants include email delivery tracking fields:

| Field | Description | Values |
|-------|-------------|--------|
| `last_invite_received_time` | When the last invite was sent | RFC3339 timestamp |
| `last_invite_received_message_id` | Email message ID for tracking | String |
| `last_invite_delivery_status` | Delivery status of last invite | "delivered", "failed" |
| `last_invite_delivery_description` | Detailed delivery information | String |

This allows monitoring of email invitation delivery success/failure rates.

---

## Proxy Conversion Logic

The proxy service automatically converts field names between the two APIs:

**Request (Proxy → ITX)**:

```go
// Proxy receives: committee_uid
// Converts to: committee_id for ITX
req.CommitteeID = payload.CommitteeUID
```

**Response (ITX → Proxy)**:

```go
// ITX returns: committee_id
// Converts to: committee_uid for proxy
response.CommitteeUID = itxResponse.CommitteeID
```

This ensures consistency with LFX naming conventions (`_uid` suffix) while maintaining compatibility with ITX requirements (`_id` suffix).
